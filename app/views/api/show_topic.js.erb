<%= render :template => 'api/base.js' if @include_base %>

<% if @user_logged_in %> 
  Juvia.user_logged_in = true;
<% end %>

<%
  options = {
    :action    => 'LoadTopic',
    :container => @container,
    :html      => render(:partial => 'topic.html', :locals => { :topic => @topic })
  }
  options[:css] = Juvia::Application.assets.find_asset('api.css').body if @include_css
%>
<%= juvia_handle_response(options) %>

<% if (comments = @topic.comments.visible.to_a).size > 0 %>
  <% comments.each_with_index do |comment, index| %>
    <% 
      options = comment_hash(comment, @username, @user_email)
      options.merge!({'action' => 'LoadComment'})
    %>
    <%= juvia_handle_response(options) %>
  <% end %>
<% end %>

